<!DOCTYPE html>
<html lang="<%= currentLanguage %>">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title><%= t('player.tournament.title', { tournamentName: viewModel.tournament.name }) %></title>
    <link rel="stylesheet" href="/bootstrap/dist/css/bootstrap.min.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" />
    <link rel="stylesheet" href="/assets/css/styles.css" />
    <link rel="stylesheet" href="/assets/css/dashboard.css" />
    <link rel="stylesheet" href="/swiper/swiper-bundle.min.css" />
</head>

<body>
    <%- include('partials/player_header') %>
    <div class="player-shell d-flex">
        <%- include('partials/player_sidebar') %>
        <div class="main flex-grow-1 p-4" style="background-color: #f0f2f5;">
            <main class="container-fluid">
                <!-- Tournament Details -->
                <div class="card mb-4">
                    <div class="card-header">
                        <h5><i class="fas fa-info-circle me-2"></i><%= t('player.tournament.summary.title') %></h5>
                    </div>
                    <div class="card-body">
                        <h1 class="h3"><%= viewModel.tournament.name %></h1>
                        <p><strong><%= t('player.tournament.summary.description') %>:</strong> <%= viewModel.tournament.description || t('player.tournament.summary.no_description') %></p>
                        <div class="row">
                            <div class="col-md-3">
                                <p><strong><%= t('player.tournament.summary.type') %>:</strong> <span class="badge bg-secondary"><%= viewModel.tournament.type %></span></p>
                            </div>
                            <div class="col-md-3">
                                <p><strong><%= t('player.tournament.summary.match_duration') %>:</strong> <%= viewModel.tournament.setting.match_duration %> min</p>
                            </div>
                            <div class="col-md-3">
                                <p><strong><%= t('player.tournament.summary.start') %>:</strong> <%= new Date(viewModel.tournament.start_date).toLocaleString(currentLanguage, { year: 'numeric' , month: '2-digit' , day: '2-digit' , hour: '2-digit' , minute: '2-digit' }) %></p>
                            </div>
                            <div class="col-md-3">
                                <p><strong><%= t('player.tournament.summary.end') %>:</strong> <%= new Date(viewModel.tournament.end_date).toLocaleString(currentLanguage, { year: 'numeric' , month: '2-digit' , day: '2-digit' , hour: '2-digit' , minute: '2-digit' }) %></p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- My Matches -->
                <div class="card mb-4">
                    <div class="card-header">
                        <h5><i class="fas fa-volleyball-ball me-2"></i><%= t('player.tournament.my_matches.title') %></h5>
                    </div>
                    <div class="card-body">
                        <% if (myMatches && myMatches.length > 0) { %>
                            <ul class="list-group">
                                <% myMatches.forEach(match => { %>
                                    <li class="list-group-item">
                                        <div class="d-flex justify-content-between">
                                            <div>
                                                <strong><%= match.team_a_players %> <%= t('player.tournament.my_matches.vs') %> <%= match.team_b_players %></strong>
                                            </div>
                                            <div>
                                                <small><%= new Date(match.start_timestamp).toLocaleString() %></small>
                                            </div>
                                        </div>
                                        <div>
                                            <%= t('player.tournament.my_matches.court') %>: <%= match.court_name %>
                                        </div>
                                    </li>
                                <% }); %>
                            </ul>
                        <% } else { %>
                            <p class="text-muted"><%= t('player.tournament.my_matches.no_matches') %></p>
                        <% } %>
                    </div>
                </div>

                <!-- All Matches -->
                <% if (viewModel.view.isElimination) { %>
                    <%- include('partials/tournament_elimination_view', { viewModel: viewModel }) %>
                <% } else { %>
                    <div class="card mb-4">
                        <div class="card-header">
                            <h5><i class="fas fa-list-alt me-2"></i><%= t('player.tournament.all_matches.title') %></h5>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <% viewModel.matches.forEach(function(match, idx) { %>
                                    <div class="col-md-6 col-lg-4 mb-4">
                                        <div class="card h-100">
                                            <div class="card-header d-flex justify-content-between align-items-center">
                                                <h6 class="mb-0"><%= t('player.tournament.all_matches.match', { number: idx + 1 }) %></h6>
                                                <%- match.phaseLabel %>
                                            </div>
                                            <div class="card-body">
                                                <p class="card-text"><strong><%= t('player.tournament.all_matches.court') %>:</strong> <%= match.courtName || '-' %></p>
                                                <div class="mb-3">
                                                    <strong><%= t('player.tournament.all_matches.team_a') %>:</strong>
                                                    <div>
                                                        <% match?.players?.teamA?.forEach(function(player) { %>
                                                            <span class="badge bg-primary me-1"><%= player.name %></span>
                                                        <% }); %>
                                                    </div>
                                                </div>
                                                <div class="mb-3">
                                                    <strong><%= t('player.tournament.all_matches.team_b') %>:</strong>
                                                    <div>
                                                        <% match?.players?.teamB?.forEach(function(player) { %>
                                                            <span class="badge bg-success me-1"><%= player.name %></span>
                                                        <% }); %>
                                                    </div>
                                                </div>
                                                <p class="card-text"><strong><%= t('player.tournament.all_matches.score') %>:</strong> <%= match.score || '-' %></p>
                                            </div>
                                        </div>
                                    </div>
                                <% }); %>
                            </div>
                        </div>
                    </div>
                <% } %>
            </main>
        </div>
    </div>
    <script src="/bootstrap/dist/js/bootstrap.bundle.min.js"></script>
    <script src="/swiper/swiper-bundle.min.js"></script>
</body>

</html>